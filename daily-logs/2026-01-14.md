# 2026-01-14 작업 일지

## 오늘 완료한 작업

### 1. 한글 폰트 문제 해결
- **문제**: 한글 자모(ㄱ, ㄴ, ㅏ, ㅓ 등)와 이모지가 박스(□)로 표시됨
- **원인**: 기존 `malgun SDF` 폰트에 한글 자모 Unicode 범위가 포함되지 않음
- **해결**:
  1. `FontAssetGenerator.cs` 에디터 스크립트 작성
  2. `malgun SDF Extended` 폰트 생성 (Dynamic 모드)
  3. Atlas 크기 2048x2048로 설정
  4. Multi Atlas Textures 활성화

**관련 파일**:
- `Assets/_Project/Scripts/Editor/FontAssetGenerator.cs` (새로 생성)
- `Assets/TextMesh Pro/Resources/Fonts & Materials/malgun SDF Extended.asset`

### 2. 이모지 지원 추가
- **문제**: 유니코드 이모지(😀, 😺 등)가 표시되지 않음
- **해결**:
  1. TextMeshPro Sprite Asset 사용 (`EmojiOne.asset`)
  2. `ChatUI.cs`에 `_emojiSpriteAsset` 필드 추가
  3. `MessageBubble.cs`의 생성 함수에 emoji 파라미터 추가
  4. `<sprite=0>` 태그로 이모지 표시

**제한사항**:
- 유니코드 이모지 직접 입력은 지원 안 함 (기술적 한계)
- `<sprite=인덱스>` 또는 `<sprite name="이름">` 태그로만 사용 가능

**수정된 파일**:
- `Assets/_Project/Scripts/UI/ChatUI.cs` - 이모지 Sprite Asset 연결
- `Assets/_Project/Scripts/UI/MessageBubble.cs` - 이모지 파라미터 추가

### 3. Unity 크래시 및 에러 해결
- Unity Editor 크래시 발생 → 폰트 생성 방식 변경
- `GlyphRenderMode` API 버전 호환성 문제 → 조건부 컴파일로 해결
- `m_AtlasTextures` 초기화 오류 → Atlas 텍스처 리스트 명시적 초기화
- 최종적으로 간소화된 복사 방식으로 변경 (안정성 향상)

### 4. 초기 메시지 수정
- "냥냥! 나는 망고야" → "안녕! 나는 망고야"
- 더미 응답: "냥냥~ 😺" → "냥냥~ <sprite=0>"

---

## 학습해야 할 Unity 개념

### TextMeshPro (TMP)
1. **TMP_FontAsset**: TextMeshPro에서 사용하는 폰트 에셋
   - SDF (Signed Distance Field): 확대해도 깨끗한 텍스트 렌더링 기술
   - Dynamic Mode: 런타임에 필요한 문자를 자동으로 추가
   - Static Mode: 미리 정의된 문자만 사용

2. **TMP_SpriteAsset**: 텍스트 안에 스프라이트(이미지) 삽입
   - `<sprite=0>`: 인덱스로 스프라이트 참조
   - `<sprite name="smile">`: 이름으로 스프라이트 참조

3. **Atlas (아틀라스)**:
   - 여러 문자의 이미지를 하나의 큰 텍스처에 모아둔 것
   - Atlas Width/Height: 텍스처 크기 (512, 1024, 2048, 4096 등)
   - Multi Atlas: 첫 번째 Atlas가 꽉 차면 두 번째 Atlas 생성

### Unity Editor 스크립트
1. **EditorWindow**: 커스텀 에디터 창 생성
   - `[MenuItem]`: Unity 메뉴에 항목 추가
   - `GetWindow<T>()`: 에디터 창 열기
   - `OnGUI()`: UI 그리기

2. **AssetDatabase**: 에셋 관리
   - `CreateAsset()`: 새 에셋 생성
   - `SaveAssets()`: 변경사항 저장
   - `Refresh()`: 에셋 새로고침

3. **EditorUtility**: 에디터 유틸리티
   - `DisplayProgressBar()`: 진행 바 표시
   - `ClearProgressBar()`: 진행 바 제거
   - `DisplayDialog()`: 대화상자 표시

### Unity UI 시스템
1. **RectTransform**: UI 요소의 위치/크기 조절
   - `anchorMin/Max`: 앵커 포인트
   - `pivot`: 회전/크기 조절 기준점
   - `sizeDelta`: 크기 조절

2. **Layout Components**:
   - `HorizontalLayoutGroup`: 가로 정렬
   - `VerticalLayoutGroup`: 세로 정렬
   - `LayoutElement`: 레이아웃 속성 정의
   - `ContentSizeFitter`: 콘텐츠에 맞게 크기 자동 조절

3. **Canvas & CanvasGroup**:
   - `Canvas`: UI 루트
   - `CanvasGroup`: UI 그룹 투명도/상호작용 제어
   - `raycastTarget`: 클릭 이벤트 수신 여부

---

## 학습해야 할 C# 개념

### 1. 조건부 컴파일
```csharp
#if UNITY_2021_2_OR_NEWER
    // Unity 2021.2 이상에서만 실행
#else
    // 그 외 버전에서 실행
#endif
```
- 버전별로 다른 코드 실행
- 플랫폼별 분기 처리

### 2. 델리게이트와 액션
```csharp
System.Action<string> onResponse
```
- `Action`: 반환값이 없는 델리게이트
- `Action<T>`: T 타입 파라미터를 받는 델리게이트
- 콜백 함수 전달에 사용

### 3. 코루틴 (Coroutine)
```csharp
IEnumerator MyCoroutine()
{
    yield return new WaitForSeconds(1f);
}
```
- 비동기 작업 처리
- `yield return`: 다음 프레임까지 대기
- Unity의 Update 루프와 함께 실행

### 4. 싱글톤 패턴
```csharp
public static ChatUI Instance { get; private set; }

private void Awake()
{
    if (Instance == null)
        Instance = this;
    else
        Destroy(gameObject);
}
```
- 게임 내에서 단 하나의 인스턴스만 존재
- 전역 접근 가능

### 5. SerializeField
```csharp
[SerializeField] private TMP_FontAsset _messageFont;
```
- private 변수를 Unity Inspector에 노출
- 캡슐화 유지하면서 에디터에서 설정 가능

### 6. null 조건부 연산자
```csharp
onResponse?.Invoke(response);
```
- `onResponse`가 null이 아닐 때만 실행
- NullReferenceException 방지

---

## 주요 디버깅 기법

### 1. Debug.Log 활용
```csharp
Debug.Log($"[ChatUI] 폰트 설정: {_messageFont.name}");
Debug.LogWarning("경고 메시지");
Debug.LogError("에러 메시지");
```
- 변수 값 확인
- 실행 흐름 추적
- 문제 위치 파악

### 2. Unity Inspector 확인
- 컴포넌트 연결 상태 확인
- Serialized 필드 값 확인
- 실시간 값 변경 테스트

### 3. Unity Console 분석
- 에러 메시지 읽는 법
- 스택 트레이스 따라가기
- 경고와 에러 구분

---

## 프로젝트 구조 이해

### 폴더 구조
```
Assets/_Project/
├── Scenes/           # 게임 씬
│   └── Main.unity
├── Scripts/
│   ├── Cat/         # 고양이 관련 스크립트
│   ├── UI/          # UI 관련 스크립트
│   ├── Managers/    # 게임 매니저
│   ├── Models/      # 데이터 모델
│   ├── API/         # API 연동
│   └── Editor/      # 에디터 스크립트 (새로 추가)
└── Prefabs/         # 프리팹
```

### 핵심 스크립트 역할
1. **ChatUI.cs**: 채팅 UI 전체 관리
2. **MessageBubble.cs**: 메시지 말풍선 생성
3. **FontAssetGenerator.cs**: 폰트 에셋 생성 도구
4. **CatInteraction.cs**: 고양이 상호작용
5. **OllamaAPIManager.cs**: AI API 연동

---

## 다음 작업 예정

### Phase 1: 초기 설정 UI
- [ ] 게임 시작 시 이름 입력 화면
- [ ] 고양이 생일 설정
- [ ] 사용자 생일 입력
- [ ] SaveData 구조 확장

### Phase 2: 기본 케어 시스템
- [ ] 밥 남은 양 표시
- [ ] 장난감 버튼 UI
- [ ] 커서 손 모양 변경
- [ ] 장난감 상호작용

### Phase 3: 호감도/성장 시스템
- [ ] 호감도 로직
- [ ] 성숙도 계산
- [ ] 일일 케어 추적

---

## 오늘 배운 교훈

1. **Unity 버전 호환성 중요**: API가 버전마다 달라질 수 있음
2. **에디터 안정성**: 복잡한 에디터 스크립트는 크래시 유발 가능
3. **단계적 접근**: 복잡한 기능은 간단한 버전부터 시작
4. **TextMeshPro 제한사항**: 컬러 이모지는 Sprite Asset으로만 가능
5. **Dynamic 폰트의 한계**: Atlas 크기 제한으로 모든 문자 미리 로드 불가능

---

## 참고 자료
- TextMeshPro 공식 문서: https://docs.unity3d.com/Manual/com.unity.textmeshpro.html
- Unity UI 가이드: https://docs.unity3d.com/Manual/UISystem.html
- C# 델리게이트: https://learn.microsoft.com/ko-kr/dotnet/csharp/programming-guide/delegates/
