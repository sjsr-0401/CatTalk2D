# 2026-01-21

## 오늘 목표
- Control 기반 프롬프트/응답 파이프라인 정리 및 적용
- DevTools AI 튜닝/벤치마크 기능 확장
- LoRA 학습용 로그/데이터셋 흐름 준비

## 변경 요약
- Ollama 연동을 Control 레이어 중심으로 재구성하고 응답 후처리/재시도/폴백을 통합
- 대화 로그에 Control JSON, 모델명, 원본 응답 등 LoRA 학습용 필드 확장
- DevTools에 모델 관리, 데이터셋 생성/내보내기, 벤치마크 실행 로직 추가
- 테스트셋(jsonl) 준비 및 모델 벤치마크 도구 기반 마련

## 변경 파일(핵심)
- `Assets/_Project/Scripts/API/OllamaAPIManager.cs`
- `Assets/_Project/Scripts/Managers/InteractionLogger.cs`
- `Tools/CatDevTools/ViewModels/MainViewModel.cs`
- `Tools/CatDevTools/Services/OllamaService.cs`
- `Tools/CatDevTools/Services/BenchmarkRunner.cs`
- `Tools/Benchmark/benchmark_models.py`
- `Tools/20260121/testset.jsonl`

## 테스트
- [ ] Unity Play 10초
- [ ] Console Error 0
- 결과:

---

## 학습 노트 (개발 스킬 기록)

### 1. 구현 영역
- **어디를**: LLM 프롬프트 생성/후처리 파이프라인, DevTools AI 튜닝/벤치마크, 로그 확장
- **무엇을**: ControlBuilder → PromptBuilder → ResponseProcessor 흐름 적용, 모델 관리/테스트셋 기반 벤치마크 구현

### 2. 객체지향 개념
- **사용된 OOP 원칙**:
  - 캡슐화: 응답 후처리/폴백을 `ResponseProcessor`로 분리
  - 상속: `MonoBehaviour` 기반 매니저 유지
  - 다형성: 서비스 계층으로 기능 분리(`OllamaService`, `BenchmarkRunner`)
  - 추상화: DevTools 기능을 ViewModel에서 통합 추상화

- **디자인 패턴**: 싱글톤(OllamaAPIManager, InteractionLogger), 서비스 레이어 분리

### 3. 메모리 & 성능 고려사항
- **메모리 할당**:
  - JSON 직렬화는 필요 시에만 수행(로그 확장 시)
- **가비지 컬렉션 최적화**:
  - 재시도 루프 최소화, 결과가 유효하면 즉시 종료
- **성능 최적화**:
  - 응답 길이 제한으로 대화 처리 시간 및 UI 부담 감소

### 4. C# 문법 & 기능
- **새로 사용한 문법**:
  - `event` 기반 모델 변경 알림
  - `async/await` 기반 Ollama 통신/벤치마크 실행
- **타입 시스템**:
  - 기록 확장 필드에 `int?` 사용(미평가 상태 표현)
- **예외 처리**:
  - API 호출 실패 시 폴백 응답 경로 정리

### 5. Unity 특화 지식
- **Unity API**:
  - `UnityWebRequest` 기반 LLM 호출
- **Unity 베스트 프랙티스**:
  - 필요 시만 로그 출력(프롬프트/Control JSON)
- **에디터 연동**:
  - DevTools와의 모델 변경 연동 포인트 확보

### 6. CS(컴퓨터과학) 개념
- **자료구조**: JSONL 기반 데이터셋 구성
- **알고리즘**: 간단한 키워드 기반 평가/스코어링
- **비동기/동시성**: 벤치마크 작업 진행률 스트리밍
- **네트워크/파일 I/O**: Ollama API, 로그/데이터셋 파일 읽기/쓰기

### 7. 실수 & 해결
- **발생한 버그**: 해당 없음
- **원인 분석**: -
- **해결 방법**: -
- **재발 방지**: -

---

## 배운 점 / 다음에 반영할 것
- Control JSON을 중심으로 파이프라인을 묶으면 튜닝/테스트 자동화가 쉬워짐
- DevTools에서 모델 관리/벤치마크를 묶어 운용하면 반복 검증이 빨라짐

## 내일 할 일(1~3개)
- Unity 쪽 모델 변경 이벤트와 DevTools 연동 구현
- 테스트셋/데이터셋 생성 흐름에 검증 및 에러 메시지 보강
- 벤치마크 결과 차트/랭킹 출력 정리 및 저장 옵션 추가
